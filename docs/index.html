
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Scorecard Safran Cabin ‚Äî Captura diaria</title>

  <!-- ‚úÖ Enlaces correctos dentro de /docs -->
  <link rel="stylesheet" href="./styles.css" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="icon" href="./icons/icon-192.png" />
  <meta name="theme-color" content="#0b1323" />
</head>
<body>
  <header>
    <h1>Scorecard Safran Cabin ‚Äî Captura diaria</h1>
  </header>

  <!-- Gate: bloquea la p√°gina hasta iniciar sesi√≥n -->
  <section id="authGate" class="auth-gate">
    <div class="gate-card">
      <h3>Acceso requerido</h3>
      <p>Inicia sesi√≥n para continuar.</p>
      <div style="margin-top:10px">
        <button id="gateLoginBtn" class="btn primary">Iniciar sesi√≥n</button>
      </div>
    </div>
  </section>

  <!-- Barra de login (usuario + Salir) -->
  <section class="auth-bar" aria-label="Autenticaci√≥n">
    <div id="authStatus" class="user"></div>
  </section>

  <!-- Di√°logo de login -->
  <dialog id="loginDialog">
    <form id="loginForm" method="dialog">
      <h3>Iniciar sesi√≥n</h3>
      <label for="loginUser">Usuario</label>
      <input id="loginUser" type="text" required />
      <label for="loginPass">Contrase√±a</label>
      <input id="loginPass" type="password" required />
      <div style="margin-top:10px">
        <button type="submit" class="btn primary">Entrar</button>
        <button type="button" class="btn" onclick="document.getElementById('loginDialog').close()">Cancelar</button>
      </div>
    </form>
  </dialog>

  <main>
    <!-- Toolbar principal -->
    <section class="toolbar" role="toolbar" aria-label="Acciones">
      <div class="field"><label for="fecha">Fecha</label><input id="fecha" type="date" /></div>
      <div class="field"><label for="programa">Programa</label><select id="programa"></select></div>
      <div class="field"><label for="tolQuick">% Amarillo</label><input id="tolQuick" type="number" min="0" max="50" step="1" placeholder="5" /></div>

      <div class="field"><label></label><button id="addAreaBtn" class="btn">‚ûï A√±adir √°rea</button></div>
      <div class="field"><label></label><button id="saveAll" class="btn">üíæ Guardar todo</button></div>
      <div class="field"><label></label><button id="exportBtn" class="btn">‚¨áÔ∏è Descargar reporte</button></div>
      <div class="field"><label></label><button id="importBtn" class="btn">‚¨ÜÔ∏è Importar reporte</button></div>
      <div class="field" style="margin-left:auto"><label></label>
        <div class="legend">
          <span class="dot green"></span> Verde
          <span class="dot yellow"></span> Amarillo
          <span class="dot red"></span> Rojo
          <span class="dot blue"></span> Azul
        </div>
      </div>
    </section>

    <!-- Conteos -->
    <section class="grid">
      <div class="card"><div class="kpi"><span class="dot green"></span><strong>Verdes:</strong> <span id="cntGreen">0</span></div></div>
      <div class="card"><div class="kpi"><span class="dot yellow"></span><strong>Amarillos:</strong> <span id="cntYellow">0</span></div></div>
      <div class="card"><div class="kpi"><span class="dot red"></span><strong>Rojos:</strong> <span id="cntRed">0</span></div></div>
      <div class="card"><div class="kpi"><span class="dot blue"></span><strong>Informativos:</strong> <span id="cntBlue">0</span></div></div>
    </section>

    <!-- √Åreas -->
    <section id="areasContainer"></section>

    <!-- Resumen semanal (Admin) -->
    <section class="weekly">
      <h3 style="margin:0 0 8px 0; color:#ffd7a6">Resumen semanal (todos los programas)</h3>
      <div id="weeklyPrograms"></div>
      <p class="hint">%/ratios se <strong>promedian</strong>. Conteos se <strong>suman</strong>. Sem√°foro semanal usa ¬±<span id="tolPctView">5</span>%.</p>
    </section>
  </main>

  <!-- Picker oculto para importar -->
  <input id="filePicker" type="file" accept="application/json" style="display:none" />

  <!-- ‚úÖ Tu l√≥gica Admin + registro del SW relativo a /docs -->
  <script src="./admin.js"></script>
  <script>
    // El SW vive en /docs ‚Üí scope efectivo /scorecard-app/
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(console.error);
    }
    // Abrir login desde el gate (por si tu admin.js no engancha el bot√≥n)
    document.getElementById('gateLoginBtn')?.addEventListener('click', () => {
      document.getElementById('loginDialog')?.showModal();
    });
  </script>
</body>
</html>
